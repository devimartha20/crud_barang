{% extends 'app_barang/layout/base.html' %}

{% block content %}
  <div class="container mt-4">
    <h2>Formulir Pembelian (PO)</h2>
    
    <!-- Menampilkan pesan jika ada error atau success -->
    {% if messages %}
      <div class="alert alert-info">
        {% for message in messages %}
          <p>{{ message }}</p>
        {% endfor %}
      </div>
    {% endif %}
    
    <form method="post" class="mt-4">
      {% csrf_token %}
      
      <div class="form-group">
        <label for="id_nomor_po">Nomor PO</label>
        {{ form.nomor_po }}
      </div>

      <div class="form-group">
        <label for="id_tanggal">Tanggal</label>
        {{ form.tanggal }}
      </div>

      <div class="form-group">
        <label for="id_pemasok">Pemasok</label>
        {{ form.pemasok }}
      </div>

      <div class="form-group">
        <label for="id_gudang">Gudang</label>
        {{ form.gudang }}
      </div>

      <div class="form-group">
        <label for="id_alamat_kirim">Alamat Kirim</label>
        {{ form.alamat_kirim }}
      </div>

      <div class="form-group">
        <label for="id_kode_barang">Kode Barang</label>
        {{ form.kode_barang }}
      </div>

      <div class="form-group">
        <label for="id_qty_po">Quantity PO</label>
        {{ form.qty_po }}
      </div>

      <div class="form-group">
        <label for="id_harga">Harga</label>
        {{ form.harga }}
      </div>

      <button type="submit" class="btn btn-primary">Simpan PO</button>
    </form>
  </div>
{% endblock %}
{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const gudangSelect = document.getElementById('id_gudang');
        const alamatKirimField = document.getElementById('id_alamat_kirim');
    
        const barangSelect = document.getElementById('id_kode_barang');
        const hargaField = document.getElementById('id_harga');
    
        gudangSelect.addEventListener('change', function () {
            const gudangId = this.value;
            if (gudangId) {
                fetch(`/ajax/get-alamat/?gudang_id=${gudangId}`)
                    .then(response => response.json())
                    .then(data => {
                        alamatKirimField.value = data.alamat;
                    });
            } else {
                alamatKirimField.value = '';
            }
        });
    
        barangSelect.addEventListener('change', function () {
            const barangId = this.value;
            if (barangId) {
                fetch(`/ajax/get-harga/?barang_id=${barangId}`)
                    .then(response => response.json())
                    .then(data => {
                        hargaField.value = data.harga;
                    });
            } else {
                hargaField.value = '';
            }
        });
    });
    </script>
{% endblock extra_js %}